<style>
/************************* Sondakika container *************************/
.sondakika-container {
  background: linear-gradient(-45deg, #7e0c06, #16345c, #0e1d33, #1e90ff);
  background-size: 400% 400%;
  animation: animatedBG 20s ease infinite;
  border-radius: 16px;
  padding: 5px;
  margin-bottom: 25px;
}
@keyframes animatedBG{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

/************************* ÅžERÄ°T *************************/
.sondakika-seridi{background:rgba(30,30,40,.9);border-radius:12px;height:60px;display:flex;overflow:hidden;box-shadow:inset 0 0 15px rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.1)}
.sondakika-title-inline{display:flex;align-items:center;padding:0 18px;color:red;font-size:1.25rem;font-weight:700;text-transform:uppercase;border-right:1px solid rgba(255,255,255,.1);white-space:nowrap}

.sondakika-haberler{flex:1;display:flex;align-items:center;overflow:hidden;position:relative}
.sondakika-haberler-icerik{display:flex;align-items:center;position:relative;}

/* Animasyon sÄ±nÄ±fÄ± - sadece yÃ¼klendikten sonra eklenir */
.sondakika-haberler-icerik.animate{
  animation:scrollNews 30s linear infinite;
}
@keyframes scrollNews{
  0%{transform:translateX(0);}
  100%{transform:translateX(-50%);}
}
.sondakika-haberler-icerik:hover{animation-play-state:paused;}

.sondakika-haber-item{display:flex;align-items:center;padding:0 28px;height:60px;white-space:nowrap;border-right:1px solid rgba(255,255,255,.05);cursor:pointer;transition:background .3s ease}
.sondakika-haber-item:hover{background:rgba(255,255,255,.05)}
.sondakika-haber-baslik{font-size:1.05rem;font-weight:500;margin-right:15px;color:#fff;max-width:550px;overflow:hidden;text-overflow:ellipsis}
.sondakika-haber-tarih{font-size:.85rem;color:#4dabf7;background:rgba(77,171,247,.1);padding:4px 10px;border-radius:20px;font-weight:500;display:flex;align-items:center;gap:5px;flex-shrink:0}

.sondakika-tum-haberler{width:110px;display:flex;justify-content:center;align-items:center;padding:0 14px;background:rgba(33,150,243,.2);border-left:1px solid rgba(255,255,255,.1);transition:background .3s ease}
.sondakika-tum-haberler:hover{background:rgba(33,150,243,.3)}
.sondakika-tum-haberler-btn{background:none;color:#fff;border:none;padding:6px 14px;border-radius:6px;font-size:.95rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:7px;transition:all .3s ease}
.sondakika-tum-haberler-btn:hover{background:rgba(255,255,255,.1)}

/************************* KATEGORÄ°LER *************************/
.sondakika-kategoriler{display:flex;justify-content:center;gap:14px;margin-top:18px;flex-wrap:wrap;color:#fff}
.sondakika-kategori{background:rgba(255,255,255,.1);padding:7px 15px;border-radius:30px;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .3s ease}
.sondakika-kategori:hover{background:rgba(33,150,243,.3)}
.sondakika-kategori.active{background:linear-gradient(to right,#2196F3,#21CBF3);font-weight:600}

/* ---- RESPONSIVE ---- */
@media(max-width:992px){
  .sondakika-seridi{height:30px}
  .sondakika-title-inline{display:none}
  .sondakika-haber-item{height:30px}
  .sondakika-haber-baslik{font-size:.85rem}
  .sondakika-tum-haberler{width:50px}
  .sondakika-tum-haberler-btn{font-size:.7rem;padding:6px}
  .sondakika-kategori{font-size:.6rem;padding:4px 5px}
}

@media (prefers-reduced-motion: reduce){
  .sondakika-container{animation:none}
  .sondakika-haberler-icerik{animation:none !important}
}
</style>

<div class="sondakika-container">
  <div class="sondakika-seridi">
    <div class="sondakika-title-inline">Son&nbsp;Dakika</div>
    <div class="sondakika-haberler">
      <div class="sondakika-haberler-icerik" id="uha-sondakikaHaberler-v2"></div>
    </div>
    <div class="sondakika-tum-haberler">
      <button class="sondakika-tum-haberler-btn" onclick="window.open('https://www.uygurhaberajansi.com/gundem','_blank','noopener,noreferrer')">
        TÃ¼mÃ¼ <i class="fas fa-arrow-right"></i>
      </button>
    </div>
  </div>

  <div class="sondakika-kategoriler">
    <div class="sondakika-kategori active" data-url="https://www.uygurhaberajansi.com/rss"><i class="fas fa-globe"></i> TÃ¼mÃ¼</div>
    <div class="sondakika-kategori" data-url="https://www.uygurhaberajansi.com/rss/magazin"><i class="fas fa-star"></i> Magazin</div>
    <div class="sondakika-kategori" data-url="https://www.uygurhaberajansi.com/rss/saglik"><i class="fas fa-heartbeat"></i> SaÄŸlÄ±k</div>
    <div class="sondakika-kategori" data-url="https://www.uygurhaberajansi.com/rss/siyaset"><i class="fas fa-landmark"></i> Siyaset</div>
    <div class="sondakika-kategori" data-url="https://www.uygurhaberajansi.com/rss/dunya"><i class="fas fa-globe-asia"></i> DÃ¼nya</div>
    <div class="sondakika-kategori" data-url="https://www.uygurhaberajansi.com/rss/spor"><i class="fas fa-futbol"></i> Spor</div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
const sondakikaHaberler = document.getElementById('uha-sondakikaHaberler-v2');
if(!sondakikaHaberler) {
  console.error('Banner widget element not found');
  return;
}

const categorieEls = document.querySelectorAll('.sondakika-kategori');

const categoryCache = {};
const categoryURLs = {
  'https://www.uygurhaberajansi.com/rss': 'TÃ¼mÃ¼',
  'https://www.uygurhaberajansi.com/rss/magazin': 'Magazin',
  'https://www.uygurhaberajansi.com/rss/saglik': 'SaÄŸlÄ±k',
  'https://www.uygurhaberajansi.com/rss/siyaset': 'Siyaset',
  'https://www.uygurhaberajansi.com/rss/dunya': 'DÃ¼nya',
  'https://www.uygurhaberajansi.com/rss/spor': 'Spor'
};
let isPreloading = true;

// JavaScript Animation Variables
let animationFrame;
let position = 0;

// RSS Ã§ekici
async function getRss(url){
  const res = await fetch(url, { cache: 'no-store' });
  const text = await res.text();
  const xml = new DOMParser().parseFromString(text, 'text/xml');
  const items = Array.from(xml.querySelectorAll('item'));
  
  const parsed = items.map(item => {
    const pubDate = new Date(item.querySelector('pubDate')?.textContent || 0);
    return {
      baslik: item.querySelector('title')?.textContent || '',
      tarih: pubDate.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'}),
      link: item.querySelector('link')?.textContent || '#',
      date: pubDate
    };
  });
  
  return parsed.sort((a, b) => b.date - a.date).slice(0, 10);
}

// Haberleri gÃ¶ster - JAVASCRIPT ANIMATION VERSION
function fill(list){
  console.log('ðŸ”„ Fill called with', list.length, 'items');
  
  // Stop any existing animation
  if(animationFrame) cancelAnimationFrame(animationFrame);
  
  // Ä°Ã§eriÄŸi oluÅŸtur
  let html = '';
  list.forEach(h => {
    html += `<div class="sondakika-haber-item" onclick="window.open('${h.link}','_blank')">
               <span class="sondakika-haber-baslik">${h.baslik}</span>
               <span class="sondakika-haber-tarih"><i class="far fa-clock"></i> ${h.tarih}</span>
             </div>`;
  });
  
  // Ä°Ã§eriÄŸi 2 kez koy (seamless loop iÃ§in)
  sondakikaHaberler.innerHTML = html + html;
  console.log('âœ… Content duplicated, width:', sondakikaHaberler.scrollWidth);
  
  // Start JavaScript animation
  position = 0;
  animate();
  console.log('ðŸŽ¬ JavaScript animation started');
}

// JavaScript animation loop - GUARANTEED TO WORK
function animate(){
  const halfWidth = sondakikaHaberler.scrollWidth / 2;
  position -= 0.5; // Move 0.5px per frame (slower, smoother)
  
  if(position <= -halfWidth) position = 0; // Reset for seamless loop
  
  sondakikaHaberler.style.transform = `translateX(${position}px)`;
  animationFrame = requestAnimationFrame(animate);
}

// Ana yÃ¼kleyici
async function load(url, forceRefresh = false){
  const cacheKey = url || 'https://www.uygurhaberajansi.com/rss';
  
  if(!forceRefresh && categoryCache[cacheKey]){
    fill(categoryCache[cacheKey]);
    return;
  }
  
  try{
    if(isPreloading) fill([{baslik:'YÃ¼kleniyorâ€¦',tarih:'',link:'#'}]);
    
    const data = await getRss(cacheKey);
    categoryCache[cacheKey] = data.length ? data : [{baslik:'Yeni Haber Yok',tarih:'',link:'#'}];
    fill(categoryCache[cacheKey]);
  }catch(e){
    console.error('RSS yÃ¼kleme hatasÄ±:', e);
    categoryCache[cacheKey] = [{baslik:'Haber yÃ¼klenemedi.',tarih:'',link:'#'}];
    fill(categoryCache[cacheKey]);
  }
}

// TÃ¼m kategorileri preload et
async function preloadAllCategories(){
  await Promise.all(Object.keys(categoryURLs).map(url => load(url, true)));
  isPreloading = false;
  fill(categoryCache['https://www.uygurhaberajansi.com/rss']);
}

// Pause animation on hover
sondakikaHaberler.addEventListener('mouseenter', () => {
  if(animationFrame) cancelAnimationFrame(animationFrame);
});
sondakikaHaberler.addEventListener('mouseleave', () => {
  animate();
});

// BaÅŸlat
document.addEventListener('DOMContentLoaded', () => {
  preloadAllCategories();
  
  categorieEls.forEach(el => {
    el.addEventListener('click', () => {
      categorieEls.forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      load(el.dataset.url);
    });
  });
  
  // 5 dakikada bir yenile
  setInterval(() => Object.keys(categoryURLs).forEach(url => load(url, true)), 300000);
});

})(); // End IIFE - isolates scope from CMS
</script>
